# Localization and Translation in the Nexus App

For more details, see [0007: Localization and Internationalisation](./decisions/backend/0007-localization-and-internationalisation.md).

In the Nexus App we use the industry standard `Resource` files for porting the App to different languages and cultures. 

This involves creating a relevant `.resx` file in every project for the base language, and additional `.resx` files for any additional language you want to support.

Working with these files requires a supported IDE such as Rider or Visual Studio

## Creating a New Language File

- Create a folder called `Resources`, if it does not already exist.
- Create a Resource file (`Add` -> `Resources`), name it `Language.resx`.

```
Resources/Language.resx
```

Doubleclicking this file in a supported IDE will bring you to the `Resource Editor`, which will allow you to edit the resources file.

### Additional Steps

For elements which may be referenced from the UI (Avalonia), an additional step is required.

When you create a Resource file from Within Rider, it will be set to `internal` by default. This is okay for code, but is not okay for XAML; as XAML needs those elements public.

To make these elements public, open the project's `.csproj` file; find the `.resx` file and change `ResXFileCodeGenerator` to `PublicResXFileCodeGenerator` such that you will see:

```
<EmbeddedResource Update="Resources\Language.resx">
    <Generator>PublicResXFileCodeGenerator</Generator>
    <LastGenOutput>Language.Designer.cs</LastGenOutput>
</EmbeddedResource>
```

You will then need to perform an action that would trigger a rebuild of `Language.Designer.cs`. This could be temporarily adding or renaming a key. These files are (unfortunately), not autogenerated as part of MSBuild.

## Adding a new Language

This should be supported as a button in your IDE (in Rider it is top left of 'Localization Manager', above the project listing).

If it is not natively supported, create a resource file using the naming convention:

```
Language.{culture}.resx
```

Manually. For example `Language.de.resx`. Both shorthands e.g. `de` (German) and full localized cultures e.g. `de-de` (German, Germany) are supported.

## Using Localized Strings

### Reference Text from C#

The items are exposed as static fields of the `Language` class; i.e.

```csharp
Language.MyGames
```

Is a valid way to reference string behind the code.
In some cases, you might have to use `string.Format` to inject parameters into the text:

```
// Resources.Hello is "Hello {0}"
string.Format(Resources.Hello, user)
```

### Reference from XAML

Use the custom `LocalizedExtension` markup extension to reference a localizable string.

```xaml
<TextBlock Text="{localization:Localized HelloWorld}"/>
```

If formatting is required, please do so in the code behind for the element to be consistent with the existing Reactive based code.

### Overriding the Language at Boot Time

You can change the locale in `AppConfig.json` file.  
This file is in the `NexusMods.App` project at time of writing and is copied to build directory.  

### Switching a Language

Language can be switched at runtime with the following code:

```
Localizer.Instance.LoadLanguage(new CultureInfo(/* locale */));
```

We run this code at startup in `OnFrameworkInitializationCompleted` to set the language at startup.