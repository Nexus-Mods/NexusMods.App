# Localization and Translation in the Nexus App

For more details, see [0007: Localization and Internationalisation](./decisions/backend/0007-localization-and-internationalisation.md).

In the Nexus App we use the industry standard `Resource` files for porting the App to different languages and cultures.

This involves creating a relevant `.resx` file in every project for the base language, and additional `.resx` files for any additional language you want to support.

Working with these files requires a supported IDE such as Rider or Visual Studio

## Creating a New Language File

- Create a folder called `Resources`, if it does not already exist.
- Create a Resource file (`Add` -> `Resources`), name it `Language.resx`.

```
Resources/Language.resx
```

Doubleclicking this file in a supported IDE will bring you to the `Resource Editor`, which will allow you to edit the resources file.

### Additional Steps

For elements which may be referenced from the UI (Avalonia), an additional step is required.

When you create a Resource file from Within Rider, it will be set to `internal` by default. This is okay for code, but is not okay for XAML; as XAML needs those elements public.

To make these elements public, open the project's `.csproj` file; find the `.resx` file and change `ResXFileCodeGenerator` to `PublicResXFileCodeGenerator` such that you will see:

```
<EmbeddedResource Update="Resources\Language.resx">
    <Generator>PublicResXFileCodeGenerator</Generator>
    <LastGenOutput>Language.Designer.cs</LastGenOutput>
</EmbeddedResource>
```

You will then need to perform an action that would trigger a rebuild of `Language.Designer.cs`. This could be temporarily adding or renaming a key. These files are (unfortunately), not autogenerated as part of MSBuild.

## Adding a new Language

This should be supported as a button in your IDE (in Rider it is top left of 'Localization Manager', above the project listing).

If it is not natively supported, create a resource file using the naming convention:

```
Language.{culture}.resx
```

Manually. For example `Language.de.resx`. Both shorthands e.g. `de` (German) and full localized cultures e.g. `de-de` (German, Germany) are supported.

## How language is changed:
The current locale for the app is set during startup, based on user configuration.

Runtime changes of the locale will not be immediately reflected in the UI, as most references are static. Users will need to be asked to restart the App for the language change to take effect.

### Overriding the Language at Boot Time

You can change the locale in `AppConfig.json` file.
This file is in the `NexusMods.App` project at time of writing and is copied to build directory.

### Switching a Language

Language can be switched at runtime with the following code:

```
Language.Culture = new CultureInfo(/* locale */);
```
Where `locale` is a string representing the locale, e.g. `it` for Italian.

We run this code at startup in `OnFrameworkInitializationCompleted` to set the language at startup.

NOTE: This will not update the UI. Users will need to be asked to restart the App for the language change to take effect.

## Using Localized Strings

### Reference Text from C#

#### Basic Referencing

The items are exposed as static fields of the `Language` class and can be used from C# code as follows:

```csharp
var text = Language.MyGames
```

Some consideration might be necessary when storing such strings before the locale is set on startup.
If the string is set before the locale is set on startup, the app will use the default english version of the string.
Though this should not be a common scenario.

#### Formatted Text

In some cases, you might have to use `string.Format` to inject parameters into the text:

```
// Language.Hello is "Hello {0}"
string.Format(Language.Hello, user)
```

### Reference from AXAML

In AXAML, you can reference localized string using static compile safe binding as follows:

```xaml
<TextBlock Text="{x:Static resources:Language.SearchBox__Search}"/>
```

If formatting is required, please do so in the code behind.

### Reference from XAML (stylesheets)

Localized references in stylesheet are not supported due to these files being loaded before the Locale is set at startup,
and not getting updated after, so the strings would always contain the default english versions.

Instead the localized strings should be set in axaml view files using the styled elements.
This might lead to some loss of convenience from styled elements use, but ensures compile time safety.
