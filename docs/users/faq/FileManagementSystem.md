# How the app manages files

The Nexus Mods app, takes a slightly different approach to file management than other apps. File management systems in
apps carry with them a lot of caveats and side effects. VFS systems require API hooking and low level manipulation
of game internals which is hard to maintain and develop. Systems that use hard or soft links follow the restrictions of
the operating system and are often hard for users to understand. The Nexus Mods app uses a different approach, namely
content hashing. 

## What is content hashing?
Content hashing (also known as just hashing) is a method of calculating a unique fingerprint for a file. In the case of 
the app, this is a 64bit integer that is unique to the contents of a given file. This allows code to quickly determine
if two files are the same, or to communicate about the contents of the file, simply by using the hash value. 

When it comes to "cleaning" a game folder or determining the state of the game folder, the app requires a database of
hashes for all the files for a specific version of the game. This database is generated by the Nexus Mods app team, but 
often requires a manual process after a game updates. Thus, there is a lag from when a game updates to when the database
is updated, and users can mod this new game version with the app. In this "lag" time, the app has no way of knowning what
files in the game folder are part of the game or some files installed by the user.

## Why does the app back up game files?
Occasionally, users may see a notice that the app attempted to back up a large amount of files. The above description of
the management process provides some context for this event. If Steam/GOG decides to update the game, it will modify almost
every file in the game folder, the app will see these changes, hash the files, and compare them to the hashes database. 
If the hashes have differed from the previous version, the app won't know what to do with the files. Thus, it will attempt
to back these files up so that they aren't lost if they are deleted or replaced. 

In user testing it's fairly common around the update of a game, to see a large number of these backups occuring. Steam/GOG
will update the game, the user will try to play the game via the app, and see `Backing up 80GB of files...`. This is 
concerning for users who are space constrained systems. 

## The fix for backed up game files
In order to implement a quick failsafe for backing up game files, the app now will refuse to back up any batch of files
over 2GB in size. This does not affect the installation of large game mods, only the backup of files installed outside of
the app. This means that after a game update users will experience a error during the apply/play process, and that error
will go away after the hash database has updated. In future versions of the app, this behavior will be refined, and we 
would like to provide a method to select the version of the game on which a given loadout is based

## FAQ - User advice
* **Q:** The game backed up a large amount of game files, what do I do?
  * First of all, wait for the new hash database to be generated. You will know when this happens, when you can see the new correct version
in the "My Games" tab
  * Close the app
  * Next, go to the archives folder for the app, normally in `C:\Users\<user>\AppData\Local\NexusMods.App\DataModel\Archives` and sort by
by file size. You should see a `.nx` file matching the size of the backed up game files, normally this is 20GB, 30GB or 80GB.
  * Rename the files to a different extension or move them to another folder.
  * Restart the app
  * Verify that you can still mod the game, play it, install new mods, etc. It is recommended that you wait a bit to make
sure you aren't deleting a `.nx` archive needed by the app
  * If you are not having issues with the modding, you can delete the renamed file
* **Q:** I'm getting an error that the game is trying to backup a large number of files, and refusing to do so
  * If the game recently updated, wait a few hours and try again. If the error persists after a day, please report the issue
to the Nexus Mods app team.
  * Be sure to restart the app to check for the new hash database, as the app always checks at startup for updates
  * The issue should resolve in a few hours when the hash database updates.
* **Q:** I'm trying to manage a game for the first time and I'm getting an error saying that the app is trying to back up files
  * If you have previously installed files in the game folder, the app will attempt to back them up to prevent data loss.
  * Go to your game folder (via GOG or Steam) and delete all the mod files.
  * Now try to manage the game
  * Note: mods files are often scattered all around the game folders, so it's often best to delete the entire game folder
and re-download the game from scratch. We hope to improve this user experience in future versions of the app.
